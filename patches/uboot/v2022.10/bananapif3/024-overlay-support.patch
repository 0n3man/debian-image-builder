From b3c5c4a58822f732466b0d37f9a32ff2ad6e566b Mon Sep 17 00:00:00 2001
From: Patrick Yavitz <pyavitz@xxxxx.com>
Date: Wed, 3 Jul 2024 19:06:03 -0400
Subject: [PATCH] overlay support

Signed-off-by: Patrick Yavitz <pyavitz@xxxxx.com>
---
 configs/k1_defconfig   | 1 +
 include/configs/k1-x.h | 2 ++
 2 files changed, 3 insertions(+)

diff --git a/configs/k1_defconfig b/configs/k1_defconfig
index 717fd2e833..86158878b4 100644
--- a/configs/k1_defconfig
+++ b/configs/k1_defconfig
@@ -272,3 +272,4 @@ CONFIG_IMAGE_SPARSE_TRANSFER_BLK_NUM=0x3000
 # CONFIG_SPL_SHA1 is not set
 # CONFIG_SPL_SHA256 is not set
 CONFIG_ZSTD=y
+CONFIG_OF_LIBFDT_OVERLAY=y
diff --git a/include/configs/k1-x.h b/include/configs/k1-x.h
index f71c955fad..90e7af63e3 100644
--- a/include/configs/k1-x.h
+++ b/include/configs/k1-x.h
@@ -136,6 +136,7 @@ struct boot_storage_op
 #define KERNEL_ADDR_R		__stringify(0x10000000)
 #define FDT_ADDR_R		__stringify(0x31000000)
 #define RAMDISK_ADDR_R		__stringify(0x21000000)
+#define FDTOVERLAY_ADDR_R	__stringify(0x01000000)
 
 #include <config_distro_bootcmd.h>
 
@@ -165,6 +166,7 @@ struct boot_storage_op
 	"fdt_addr_r=" FDT_ADDR_R "\0" \
 	"kernel_addr_r=" KERNEL_ADDR_R "\0" \
 	"ramdisk_addr_r=" RAMDISK_ADDR_R "\0" \
+	"fdtoverlay_addr_r=" FDTOVERLAY_ADDR_R "\0" \
 	"fdtfile=spacemit/" CONFIG_DEFAULT_DEVICE_TREE ".dtb\0" \
 	BOOTENV_DEVICE_CONFIG
 
-- 
2.39.2

