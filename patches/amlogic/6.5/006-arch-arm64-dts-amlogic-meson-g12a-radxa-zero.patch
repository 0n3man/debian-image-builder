From ebe856d062697349e844304f1c5ced6a0ea95391 Mon Sep 17 00:00:00 2001
From: Patrick Yavitz <pyavitz@xxxxx.com>
Date: Fri, 28 Jul 2023 18:12:26 -0400
Subject: [PATCH] arch: arm64: dts: amlogic: meson-g12a-radxa-zero

Signed-off-by: Patrick Yavitz <pyavitz@xxxxx.com>
---
 .../boot/dts/amlogic/meson-g12-common.dtsi    | 32 ++++++++++++
 .../dts/amlogic/meson-g12a-radxa-zero.dts     | 49 ++++++++++++++++++-
 arch/arm64/boot/dts/amlogic/meson-g12a.dtsi   |  6 +++
 3 files changed, 86 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi b/arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi
index 88b848c65b0d..6b9bd1e22852 100644
--- a/arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-g12-common.dtsi
@@ -797,6 +797,22 @@ mux {
 						};
 					};
 
+					pwm_b_h7_pins: pwm-b-h7 {
+						mux {
+							groups = "pwm_b_h7";
+							function = "pwm_b";
+							bias-disable;
+						};
+					};
+
+					pwm_b_z0_pins: pwm-b-z0 {
+						mux {
+							groups = "pwm_b_z0";
+							function = "pwm_b";
+							bias-disable;
+						};
+					};
+
 					pwm_c_c_pins: pwm-c-c {
 						mux {
 							groups = "pwm_c_c";
@@ -821,6 +837,14 @@ mux {
 						};
 					};
 
+					pwm_c_z1_pins: pwm-c-z1 {
+						mux {
+							groups = "pwm_c_z1";
+							function = "pwm_c";
+							bias-disable;
+						};
+					};
+
 					pwm_d_x3_pins: pwm-d-x3 {
 						mux {
 							groups = "pwm_d_x3";
@@ -837,6 +861,14 @@ mux {
 						};
 					};
 
+					pwm_d_z2_pins: pwm-d-z2 {
+						mux {
+							groups = "pwm_d_z2";
+							function = "pwm_d";
+							bias-disable;
+						};
+					};
+
 					pwm_e_pins: pwm-e {
 						mux {
 							groups = "pwm_e";
diff --git a/arch/arm64/boot/dts/amlogic/meson-g12a-radxa-zero.dts b/arch/arm64/boot/dts/amlogic/meson-g12a-radxa-zero.dts
index cf0a9be83fc4..45b18f1f383a 100644
--- a/arch/arm64/boot/dts/amlogic/meson-g12a-radxa-zero.dts
+++ b/arch/arm64/boot/dts/amlogic/meson-g12a-radxa-zero.dts
@@ -60,6 +60,17 @@ sdio_pwrseq: sdio-pwrseq {
 		clock-names = "ext_clock";
 	};
 
+	typec2_vbus: regulator-typec2_vbus {
+		compatible = "regulator-fixed";
+		regulator-name = "TYPEC2_VBUS";
+		regulator-min-microvolt = <5000000>;
+		regulator-max-microvolt = <5000000>;
+		vin-supply = <&ao_5v>;
+
+		gpio = <&gpio_ao GPIOAO_7 GPIO_ACTIVE_HIGH>;
+		enable-active-high;
+	};
+
 	ao_5v: regulator-ao_5v {
 		compatible = "regulator-fixed";
 		regulator-name = "AO_5V";
@@ -191,6 +202,18 @@ wifi32k: wifi32k {
 	};
 };
 
+&ao_pinctrl {
+	/* Ensure the TYPE C controller irq pin is not driven by the SoC */
+	fusb302_irq_pins: fusb302_irq {
+		mux {
+			groups = "GPIOAO_5";
+			function = "gpio_aobus";
+			bias-pull-up;
+			output-disable;
+		};
+	};
+};
+
 &arb {
 	status = "okay";
 };
@@ -278,6 +301,22 @@ &ir {
 	pinctrl-names = "default";
 };
 
+&i2c_AO {
+	fusb302@22 {
+		compatible = "fcs,fusb302";
+		reg = <0x22>;
+
+		pinctrl-0 = <&fusb302_irq_pins>;
+		pinctrl-names = "default";
+		interrupt-parent = <&gpio_intc>;
+		interrupts = <5 IRQ_TYPE_LEVEL_LOW>;
+
+		vbus-supply = <&typec2_vbus>;
+
+		status = "okay";
+	};
+};
+
 &pwm_AO_cd {
 	pinctrl-0 = <&pwm_ao_d_e_pins>;
 	pinctrl-names = "default";
@@ -310,7 +349,7 @@ &sd_emmc_a {
 
 	bus-width = <4>;
 	cap-sd-highspeed;
-	sd-uhs-sdr50;
+	cap-mmc-highspeed;
 	max-frequency = <100000000>;
 
 	non-removable;
@@ -402,3 +441,11 @@ &uart_AO {
 &usb {
 	status = "okay";
 };
+
+&usb2_phy0 {
+	phy-supply = <&typec2_vbus>;
+};
+
+&usb3_pcie_phy {
+	phy-supply = <&typec2_vbus>;
+};
diff --git a/arch/arm64/boot/dts/amlogic/meson-g12a.dtsi b/arch/arm64/boot/dts/amlogic/meson-g12a.dtsi
index 6eaceb717d61..dfc216e93767 100644
--- a/arch/arm64/boot/dts/amlogic/meson-g12a.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-g12a.dtsi
@@ -91,6 +91,12 @@ opp-1800000000 {
 			opp-hz = /bits/ 64 <1800000000>;
 			opp-microvolt = <981000>;
 		};
+
+		opp-2004000000 {
+			opp-hz = /bits/ 64 <2004000000>;
+			opp-microvolt = <1022000>;
+			turbo-mode;
+		};
 	};
 };
 
-- 
2.39.2

