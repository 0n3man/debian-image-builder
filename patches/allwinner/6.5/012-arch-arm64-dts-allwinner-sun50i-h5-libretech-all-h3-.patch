From ae62a05a35031f8e2c8d7dcd2b88f28d31834e26 Mon Sep 17 00:00:00 2001
From: Patrick Yavitz <pyavitz@xxxxx.com>
Date: Sun, 30 Jul 2023 10:08:10 -0400
Subject: [PATCH] arch: arm64: dts: allwinner: sun50i-h5-libretech-all-h3-cc

Signed-off-by: Patrick Yavitz <pyavitz@xxxxx.com>
---
 .../boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts  | 8 ++++++++
 .../boot/dts/allwinner/sun50i-h5-libretech-all-h5-cc.dts  | 8 ++++++++
 2 files changed, 16 insertions(+)

diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts b/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts
index d811df332824..c0a9522950f8 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts
@@ -15,3 +15,11 @@ / {
 &mmc2 {
 	mmc-ddr-3_3v;
 };
+
+&sound_hdmi {
+	status = "okay";
+};
+
+&i2s2 {
+	status = "okay";
+};
diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h5-cc.dts b/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h5-cc.dts
index 6e30a564c87f..bee5316849d5 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h5-cc.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h5-cc.dts
@@ -30,6 +30,14 @@ &codec {
 		"Mic",  "MBIAS";
 };
 
+&sound_hdmi {
+	status = "okay";
+};
+
+&i2s2 {
+	status = "okay";
+};
+
 /* This board has external PHY */
 &emac {
 	pinctrl-names = "default";
-- 
2.39.2

From e90494664cd8b2453189d88eeb85d73d5c1e025d Mon Sep 17 00:00:00 2001
From: Patrick Yavitz <pyavitz@xxxxx.com>
Date: Mon, 13 Nov 2023 08:43:36 -0500
Subject: [PATCH] sun50i-h5-libretech-all-h3-cc: drop support for memory
 dynamic frequency scaling

The introduction of DRAM devfreq support for Allwinner A64/H5
has made the USB ports basically unusable without an HDMI cable
plugged in. By dropping support for the driver it now behaves as
it should with or without the HDMI port in use.

Example of error:
usb usb5-port1: disabled by hub (EMI?), re-enabling...

https://lore.kernel.org/linux-arm-kernel/a48923b7-12f9-808e-1171-49b826bd5f1c@samsung.com/T/#ma00a3e07248dc7fb2d300b7c9c409f69ffa64c14

Signed-off-by: Patrick Yavitz <pyavitz@xxxxx.com>
---
 .../dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts  | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts b/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts
index 1d39846df3b8..086d9ad9be9c 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h5-libretech-all-h3-cc.dts
@@ -12,6 +12,18 @@ / {
 	compatible = "libretech,all-h3-cc-h5", "allwinner,sun50i-h5";
 };
 
+&mbus {
+	compatible = "allwinner,sun8i-h3-mbus";
+	reg = <0x01c62000 0x1000>;
+	/delete-property/ reg-names;	
+	clocks = <&ccu CLK_MBUS>;
+	/delete-property/ clock-names;
+	#address-cells = <1>;
+	#size-cells = <1>;
+	dma-ranges = <0x00000000 0x40000000 0xc0000000>;
+	#interconnect-cells = <1>;
+};
+
 &i2s2 {
 	status = "okay";
 };
-- 
2.39.2

