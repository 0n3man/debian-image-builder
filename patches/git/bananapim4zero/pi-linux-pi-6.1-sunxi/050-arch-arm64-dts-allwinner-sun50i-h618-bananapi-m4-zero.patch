From ad7cc7f7a4a2dd7a94cef5c11b5c51e89602e150 Mon Sep 17 00:00:00 2001
From: Patrick Yavitz <pyavitz@xxxxx.com>
Date: Fri, 9 Feb 2024 03:16:28 -0500
Subject: [PATCH] arch: arm64: dts: allwinner: sun50i-h618-bananapi-m4-zero

Signed-off-by: Patrick Yavitz <pyavitz@xxxxx.com>
---
 arch/arm64/boot/dts/allwinner/Makefile        |  2 +-
 ...o.dts => sun50i-h618-bananapi-m4-zero.dts} | 57 ++++++++++---------
 2 files changed, 30 insertions(+), 29 deletions(-)
 rename arch/arm64/boot/dts/allwinner/{sun50i-h618-bananapi-m4zero.dts => sun50i-h618-bananapi-m4-zero.dts} (87%)

diff --git a/arch/arm64/boot/dts/allwinner/Makefile b/arch/arm64/boot/dts/allwinner/Makefile
index 9ca0e352fc..33238b5eee 100644
--- a/arch/arm64/boot/dts/allwinner/Makefile
+++ b/arch/arm64/boot/dts/allwinner/Makefile
@@ -1,6 +1,6 @@
 # SPDX-License-Identifier: GPL-2.0
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h618-bananapi-m4berry.dtb
-dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h618-bananapi-m4zero.dtb
+dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h618-bananapi-m4-zero.dtb
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h616-orangepi-zero2.dtb
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h616-orangepi-zero3.dtb
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h616-orangepi-zero2w.dtb
diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h618-bananapi-m4zero.dts b/arch/arm64/boot/dts/allwinner/sun50i-h618-bananapi-m4-zero.dts
similarity index 87%
rename from arch/arm64/boot/dts/allwinner/sun50i-h618-bananapi-m4zero.dts
rename to arch/arm64/boot/dts/allwinner/sun50i-h618-bananapi-m4-zero.dts
index a22436fd69..8205ecbf53 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h618-bananapi-m4zero.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h618-bananapi-m4-zero.dts
@@ -14,10 +14,10 @@
 
 / {
 	model = "BananaPi M4 Zero";
-	compatible = "BiPai,bananapi-m4zero", "allwinner,sun50i-h616";
+	compatible = "sinovoip,bpi-m4-zero", "allwinner,sun50i-h616";
 
 	aliases {
-		ethernet0 = &emac1;
+		//ethernet0 = &emac1;
 		serial0 = &uart0;
 		serial5 = &uart5;
 	};
@@ -37,21 +37,22 @@ hdmi_con_in: endpoint {
 		};
 	};
 
-	leds: leds {
+	leds {
 		compatible = "gpio-leds";
 
-		led-greed {
-			label = "red_led";
+		led-red {
+			color = <LED_COLOR_ID_RED>;
+			function = LED_FUNCTION_STATUS;
 			gpios = <&pio 2 12 GPIO_ACTIVE_HIGH>; /* PC12 */
 			linux,default-trigger = "heartbeat";
 		};
 	};
 
-	wifi_usb {
-		compatible = "usb-wifi";
-		status = "okay";
-		power_on_pin = <&pio 2 2 GPIO_ACTIVE_HIGH>; /* PC2 */
-	};
+	//wifi_usb {
+	//	compatible = "usb-wifi";
+	//	status = "okay";
+	//	power_on_pin = <&pio 2 2 GPIO_ACTIVE_HIGH>; /* PC2 */
+	//};
 
 	reg_vcc5v: vcc5v {
 		/* board wide 5V supply directly from the USB-C socket */
@@ -83,23 +84,23 @@ &gpu {
 	status = "disabled";
 };
 
-&emac1 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&rmii_pins>;
-	phy-mode = "rmii";
-	phy-handle = <&rmii_phy>;
-	phy-supply = <&reg_dldo1>;
-	allwinner,rx-delay-ps = <3100>;
-	allwinner,tx-delay-ps = <700>;
-	status = "okay";
-};
-
-&mdio1 {
-	rmii_phy: ethernet-phy@1 {
-		compatible = "ethernet-phy-ieee802.3-c22";
-		reg = <1>;
-	};
-};
+//&emac1 {
+//	pinctrl-names = "default";
+//	pinctrl-0 = <&rmii_pins>;
+//	phy-mode = "rmii";
+//	phy-handle = <&rmii_phy>;
+//	phy-supply = <&reg_dldo1>;
+//	allwinner,rx-delay-ps = <3100>;
+//	allwinner,tx-delay-ps = <700>;
+//	status = "okay";
+//};
+//
+//&mdio1 {
+//	rmii_phy: ethernet-phy@1 {
+//		compatible = "ethernet-phy-ieee802.3-c22";
+//		reg = <1>;
+//	};
+//};
 
 &mmc0 {
 	vmmc-supply = <&reg_dldo1>;
@@ -195,7 +196,7 @@ &usbotg {
 	 * need to adjust the DT accordingly: dr_mode set to "host",
 	 * enabling OHCI0 and EHCI0.
 	 */
-	dr_mode = "peripheral";
+	dr_mode = "host";
 	status = "okay";
 };
 
-- 
2.39.2

