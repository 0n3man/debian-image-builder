#!/bin/bash
### DO NOT EDIT
source lib/boards/$1
MAKE_OUTPUT="output/$1"
TITLE=`echo "$1" | sed -e 's/\(.*\)/\U\1/'`
DIALOG_CANCEL=1
DIALOG_ESC=255
HEIGHT=0
WIDTH=0

while true; do
	exec 3>&1
	selection=$(dialog \
	--backtitle "Debian Image Builder" \
	--title "$TITLE" \
	--clear \
	--cancel-label "Exit" \
	--menu "Select:" $HEIGHT $WIDTH 4 \
	"1" "Make All" \
	"2" "Make U-Boot" \
	"3" "Make Kernel" \
	"4" "Make ROOTFS" \
	"5" "Make Image" \
	2>&1 1>&3)
	exit_status=$?
	exec 3>&-;
case $exit_status in
	$DIALOG_CANCEL)
		clear
		echo "Program terminated."
		exit
	;;
	$DIALOG_ESC)
		clear
		echo "Program aborted." >&2
		exit 1
	;;
esac
case $selection in
	0 )
		clear
		echo "Program terminated."
	;;
	1 )
		make "all" "board=$1"
		dialog --prgbox "Results:" "ls $IMG_EXP *$ARCH_EXT* $MAKE_OUTPUT/" 30 75
		exit 0
	;;
	2 )
		make "uboot" "board=$1"
		# check rockchip u-boot binaries
		if [ -e $MAKE_OUTPUT/*.itb ]; then
			dialog --prgbox "Results:" "ls $MAKE_OUTPUT/*.bin; ls $MAKE_OUTPUT/*.itb" 30 75;
		else
			dialog --prgbox "Results:" "ls $MAKE_OUTPUT/*.bin" 30 75;
		fi
	;;
	3 )
		make "kernel" "board=$1"
		dialog --prgbox "Results:" "ls $MAKE_OUTPUT/*.deb" 30 75
	;;
	4 )
		make "rootfs" "board=$1"
		dialog --prgbox "Results:" "ls *$ARCH_EXT*" 30 75
	;;
	5 )
		make "image" "board=$1"
		dialog --prgbox "Results:" "ls $IMG_EXP" 30 75
	;;
esac
done
