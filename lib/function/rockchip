#!/bin/bash

# rockchip flash u-boot
flash_uboot(){
dd if=${OUTPUT}/idbloader.bin of="${IMAGE_LOOP_DEV}" seek=64
dd if=${OUTPUT}/u-boot.itb of="${IMAGE_LOOP_DEV}" seek=16384
}

nanopir5s_udev_rules(){
mkdir -p /etc/udev/rules.d
echo 'SUBSYSTEM=="leds", KERNEL=="green:wan", ACTION=="add", ATTR{trigger}="netdev", ATTR{device_name}="eth2", ATTR{link}="1" ATTR{rx}="1" ATTR{tx}="1"' > /etc/udev/rules.d/10-nanopi-r5s-led.rules
echo 'SUBSYSTEM=="leds", KERNEL=="green:lan1", ACTION=="add", ATTR{trigger}="netdev", ATTR{device_name}="eth0", ATTR{link}="1" ATTR{rx}="1" ATTR{tx}="1"' >> /etc/udev/rules.d/10-nanopi-r5s-led.rules
echo 'SUBSYSTEM=="leds", KERNEL=="green:lan2", ACTION=="add", ATTR{trigger}="netdev", ATTR{device_name}="eth1", ATTR{link}="1" ATTR{rx}="1" ATTR{tx}="1"' >> /etc/udev/rules.d/10-nanopi-r5s-led.rules
}

nanopir5s_ifupdown(){
if [[ -f "/etc/opt/interfaces" ]]; then
	sed -i 's/#allow-hotplug eth1/allow-hotplug eth1/g' /etc/opt/interfaces
	sed -i 's/#iface eth1 inet dhcp/iface eth1 inet dhcp/g' /etc/opt/interfaces
	sed -i 's/#allow-hotplug eth2/allow-hotplug eth2/g' /etc/opt/interfaces
	sed -i 's/#iface eth2 inet dhcp/iface eth2 inet dhcp/g' /etc/opt/interfaces
fi
if [[ -f "/etc/opt/interfaces.manual" ]]; then
	sed -i 's/#allow-hotplug eth1/allow-hotplug eth1/g' /etc/opt/interfaces.manual
	sed -i 's/#iface eth1 inet dhcp/iface eth1 inet dhcp/g' /etc/opt/interfaces.manual
	sed -i 's/#allow-hotplug eth2/allow-hotplug eth2/g' /etc/opt/interfaces.manual
	sed -i 's/#iface eth2 inet dhcp/iface eth2 inet dhcp/g' /etc/opt/interfaces.manual
fi
}
